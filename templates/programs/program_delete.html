{% extends 'base.html' %}

{% block title %}{{ page_title }} - UPG Management System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-trash text-danger"></i> {{ page_title }}</h1>
    <a href="{% url 'programs:program_detail' program.pk %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Program
    </a>
</div>

<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5><i class="fas fa-exclamation-triangle"></i> Confirm Program Deletion</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-danger">
                    <h6><i class="fas fa-warning"></i> CRITICAL WARNING: This action cannot be undone!</h6>
                    <p class="mb-0">You are about to permanently delete the following program and ALL associated data:</p>
                </div>

                <div class="card bg-light">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6><strong>{{ program.name }}</strong></h6>
                                <p><strong>Type:</strong> {{ program.get_program_type_display }}</p>
                                <p><strong>Status:</strong>
                                    <span class="badge bg-{% if program.status == 'active' %}success{% elif program.status == 'paused' %}warning{% elif program.status == 'ended' %}danger{% else %}secondary{% endif %}">
                                        {{ program.get_status_display }}
                                    </span>
                                </p>
                                <p><strong>County:</strong> {{ program.county|default:"All Counties" }}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Created:</strong> {{ program.created_at|date:"M d, Y" }}</p>
                                <p><strong>Created By:</strong> {{ program.created_by.get_full_name|default:program.created_by.username }}</p>
                                <p><strong>Target Beneficiaries:</strong> {{ program.target_beneficiaries }}</p>
                                {% if program.budget %}
                                <p><strong>Budget:</strong> KES {{ program.budget|floatformat:0 }}</p>
                                {% endif %}
                            </div>
                        </div>

                        <div class="mt-3">
                            <h6>Description:</h6>
                            <p class="text-muted">{{ program.description|truncatewords:30 }}</p>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <h6><i class="fas fa-times-circle text-danger"></i> This will permanently delete:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-times text-danger me-2"></i>The program record</li>
                            <li><i class="fas fa-times text-danger me-2"></i>All {{ applications_count }} program applications</li>
                            <li><i class="fas fa-times text-danger me-2"></i>All {{ business_groups_count }} linked business groups</li>
                            <li><i class="fas fa-times text-danger me-2"></i>All SB and PR grant records</li>
                            <li><i class="fas fa-times text-danger me-2"></i>All program participation history</li>
                            <li><i class="fas fa-times text-danger me-2"></i>All related survey and tracking data</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-info-circle text-info"></i> Impact Summary:</h6>
                        <div class="card bg-light">
                            <div class="card-body py-2">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Applications:</span>
                                    <strong class="text-warning">{{ applications_count }}</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Business Groups:</span>
                                    <strong class="text-warning">{{ business_groups_count }}</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Status:</span>
                                    <strong class="text-{% if program.status == 'active' %}danger{% else %}warning{% endif %}">
                                        {{ program.get_status_display }}
                                    </strong>
                                </div>
                            </div>
                        </div>

                        {% if program.status == 'active' %}
                        <div class="alert alert-warning mt-3">
                            <small>
                                <i class="fas fa-exclamation-triangle"></i>
                                <strong>Active Program:</strong> This program is currently active and may have ongoing activities.
                            </small>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="mt-4">
                    <div class="alert alert-info">
                        <h6><i class="fas fa-lightbulb"></i> Alternative Actions:</h6>
                        <p class="mb-2">Instead of deleting, consider:</p>
                        <ul class="mb-0">
                            <li><strong>Pause the program</strong> if it's temporarily inactive</li>
                            <li><strong>End the program</strong> if it has completed its cycle</li>
                            <li><strong>Archive the program</strong> to maintain historical records</li>
                        </ul>
                    </div>
                </div>

                <form method="post" class="mt-4">
                    {% csrf_token %}
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="confirm_delete" required>
                        <label class="form-check-label text-danger" for="confirm_delete">
                            <strong>I understand this action is permanent and will delete all program data</strong>
                        </label>
                    </div>

                    <div class="d-flex justify-content-end gap-2">
                        <a href="{% url 'programs:program_detail' program.pk %}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <a href="{% url 'programs:program_toggle_status' program.pk %}" class="btn btn-warning">
                            <i class="fas fa-pause"></i> Pause Instead
                        </a>
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Yes, Delete Permanently
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}